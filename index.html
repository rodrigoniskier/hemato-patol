<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patologia Geral e Hematologia Interativa</title>

    <style>
        /* ------------------- */
        /* RESET E VARIAVEIS   */
        /* ------------------- */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --highlight-color: #e74c3c;
            --text-color: #333;
            --bg-color: #ecf0f1;
            --sidebar-width: 300px;
            --header-height: 60px;
            --border-radius: 8px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        /* ------------------- */
        /* LAYOUT PRINCIPAL    */
        /* ------------------- */
        .app-container {
            display: flex;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar-content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .content-wrapper {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-content {
            flex-grow: 1;
            padding: 20px;
            background-image: url('./laboratory-background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .main-footer {
            text-align: center;
            padding: 15px;
            background-color: var(--secondary-color);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }
        
        .content-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        /* ------------------- */
        /* SIDEBAR E NAVEGAÇÃO */
        /* ------------------- */
        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .sidebar-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .sidebar-nav li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background 0.2s ease;
            margin-bottom: 5px;
        }

        .sidebar-nav li a:hover, .sidebar-nav li a.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--highlight-color);
            padding-left: 11px;
        }
        
        .sidebar-nav li a .icon {
            margin-right: 15px;
            font-size: 1.2em;
        }

        .hamburger-menu {
            display: none; /* Oculto por padrão em telas grandes */
        }
        
        /* ------------------- */
        /* COMPONENTES GERAIS  */
        /* ------------------- */
        h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        h3 {
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        p { margin-bottom: 1em; }
        ul, ol { padding-left: 20px; margin-bottom: 1em; }

        .button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-size: 1em;
        }
        
        .button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .button.secondary { background-color: var(--secondary-color); }
        .button.secondary:hover { background-color: #1f2b38; }

        .button.danger { background-color: var(--highlight-color); }
        .button.danger:hover { background-color: #c0392b; }

        /* ------------------- */
        /* COMPONENTES INTERATIVOS */
        /* ------------------- */

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
            color: var(--primary-color);
            font-weight: bold;
            border-bottom: 2px dotted var(--primary-color);
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: var(--secondary-color);
            color: #fff;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
            font-weight: normal;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Accordion */
        .accordion-item {
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        .accordion-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-header::after {
            content: '+';
            font-size: 1.5em;
            transition: transform 0.3s ease;
        }
        .accordion-item.active .accordion-header::after {
            transform: rotate(45deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease;
            background-color: #fff;
            padding: 0 20px;
        }
        .accordion-item.active .accordion-content {
            padding: 20px;
        }
        
        /* Tabs */
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            flex-wrap: wrap;
        }
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Flashcards */
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .flashcard {
            width: 500px;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-size: 1.5em;
            text-align: center;
        }
        .flashcard-front {
            background: linear-gradient(135deg, #f0f0f0, #ffffff);
            color: var(--secondary-color);
        }
        .flashcard-back {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            transform: rotateY(180deg);
            font-size: 1.2em;
        }
        .flashcard-nav {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Quiz Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            position: relative;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .quiz-question { margin-bottom: 20px; }
        .quiz-options label {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .quiz-options label:hover { background-color: #f0f0f0; }

        .quiz-result div { margin-bottom: 10px; }
        .review-question {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
        }
        .review-question.correct { background-color: #d4edda; }
        .review-question.incorrect { background-color: #f8d7da; }
        
        /* Custom Quiz Builder */
        .quiz-builder-form-group {
            margin-bottom: 20px;
        }
        .quiz-builder-form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .quiz-builder-form-group input[type="range"] {
            width: 100%;
        }
        .quiz-builder-form-group .checkbox-group label {
            display: inline-block;
            margin-right: 15px;
            font-weight: normal;
        }

        /* ------------------- */
        /* RESPONSIVIDADE      */
        /* ------------------- */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
                box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            }
            .content-wrapper {
                margin-left: 0;
            }
            .hamburger-menu {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1001;
                background-color: var(--secondary-color);
                color: white;
                border: none;
                border-radius: 50%;
                width: 50px;
                height: 50px;
                font-size: 24px;
                cursor: pointer;
                box-shadow: var(--shadow);
            }
            .flashcard {
                width: 100%;
                max-width: 400px;
            }
        }
        
        @media (max-width: 576px) {
            .content-box {
                padding: 15px;
            }
            .flashcard {
                height: 250px;
                font-size: 1.2em;
            }
            .flashcard-back {
                font-size: 1em;
            }
            .tabs-container {
                flex-direction: column;
            }
            .tab-button {
                width: 100%;
                text-align: left;
                border-bottom: 1px solid #ccc;
            }
            .tab-button.active {
                border-bottom: 3px solid var(--primary-color);
            }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <h1>Patologia Interativa</h1>
                    <p>Princípios e Aplicações em Hematologia</p>
                </div>
                <nav class="sidebar-nav" id="sidebar-nav">
                    <ul>
                        <li><a href="#" class="nav-link active" data-target="home"><span class="icon">🏠</span> Início</a></li>
                        <li><a href="#" class="nav-link" data-target="course-content"><span class="icon">📚</span> Conteúdo do Curso</a></li>
                        <li><a href="#" class="nav-link" data-target="flashcards"><span class="icon">🧠</span> Flashcards de Revisão</a></li>
                        <li><a href="#" class="nav-link" data-target="custom-quiz"><span class="icon">✍️</span> Montar Simulado</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <button class="hamburger-menu" id="hamburger-menu">☰</button>

        <div class="content-wrapper">
            <main class="main-content" id="main-content">
                </main>

            <footer class="main-footer">
                <p>&copy; 2025 Parceiro de Programação. Todos os direitos reservados.</p>
                <p>Conteúdo educacional adaptado do material fornecido.</p>
            </footer>
        </div>
    </div>

    <div id="quiz-modal" class="modal">
        <div class="modal-content" id="quiz-modal-content">
            </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ===============================================
        // BANCO DE DADOS - Conteúdo, Quizzes, Flashcards
        // ===============================================
        const courseData = [
            {
                id: 'mod1',
                title: 'Módulo 1: A Célula Sob Ameaça: Lesão, Adaptação e Morte',
                icon: '🩺',
                image: 'hematopoietic-stem-cells.jpg',
                sections: [
                    {
                        id: 'sec1-1',
                        title: 'Lesão Celular e Toxicidade Medular',
                        content: `
                            <p>A patologia estuda as reações de células e tecidos a estímulos nocivos. A célula opera em <span class="tooltip" data-definition="Estado de equilíbrio dinâmico da célula.">homeostase</span>, mas estresse severo ou prolongado causa lesão. Se o ponto de não retorno é ultrapassado, a lesão torna-se irreversível, culminando na morte celular.</p>
                            <h3>Mecanismos de Lesão Celular:</h3>
                            <ul>
                                <li><b>Depleção de <span class="tooltip" data-definition="Adenosina Trifosfato, a principal moeda energética da célula.">ATP</span>:</b> A falta de energia por <span class="tooltip" data-definition="Baixa concentração de oxigênio nos tecidos.">hipóxia</span> ou toxinas afeta bombas iônicas (causando edema celular) e a síntese de proteínas.</li>
                                <li><b>Dano Mitocondrial:</b> Pode levar à falha na produção de ATP e à liberação de proteínas que ativam a <span class="tooltip" data-definition="Morte celular programada, um processo organizado e sem inflamação.">apoptose</span>, como o citocromo c.</li>
                                <li><b>Influxo de Cálcio (Ca²+):</b> Ativa enzimas destrutivas (fosfolipases, proteases) que degradam componentes celulares.</li>
                                <li><b>Estresse Oxidativo:</b> O acúmulo de <span class="tooltip" data-definition="Espécies Reativas de Oxigênio, ou radicais livres, que causam dano celular.">EROs</span> danifica lipídios, proteínas e DNA.</li>
                            </ul>
                            <h3>Estudo de Caso: Toxicidade do Benzeno</h3>
                            <p>O benzeno é metabolizado no fígado em compostos reativos que atacam as <span class="tooltip" data-definition="Célula-tronco hematopoiética, responsável por gerar todas as células do sangue.">CTHs</span> na medula óssea. Isso causa estresse oxidativo, dano ao DNA e pode levar à <span class="tooltip" data-definition="Redução de todas as linhagens celulares do sangue (eritrócitos, leucócitos, plaquetas).">pancitopenia</span> ou até Leucemia Mieloide Aguda (<span class="tooltip" data-definition="Câncer que se origina nas células mieloides da medula óssea.">LMA</span>).</p>
                        `,
                        quiz: [
                            { q: "Qual o termo para o estado de equilíbrio dinâmico da célula?", options: ["Metaplasia", "Homeostase", "Hipóxia", "Apoptose"], a: 1, d: 'Fácil' },
                            { q: "Qual dos seguintes NÃO é um mecanismo primário de lesão celular?", options: ["Depleção de ATP", "Dano mitocondrial", "Aumento da síntese de proteínas", "Estresse oxidativo"], a: 2, d: 'Médio' },
                            { q: "A toxicidade do Benzeno afeta primariamente qual tipo de célula na medula óssea?", options: ["Linfócitos T", "Plasmócitos", "Células-tronco hematopoiéticas (CTHs)", "Eritrócitos maduros"], a: 2, d: 'Médio' },
                            { q: "O influxo excessivo de qual íon ativa enzimas destrutivas como fosfolipases e proteases durante a lesão celular?", options: ["Sódio (Na+)", "Potássio (K+)", "Cálcio (Ca²+)", "Cloro (Cl-)"], a: 2, d: 'Difícil' }
                        ]
                    },
                    {
                        id: 'sec1-2',
                        title: 'Adaptação Celular e Respostas Medulares',
                        content: `
                            <p>Células podem se adaptar a estresses para sobreviver. As adaptações incluem:</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Aumento no NÚMERO de células."><b>Hiperplasia:</b></span> Aumento no número de células.</li>
                                <li><span class="tooltip" data-definition="Aumento no TAMANHO das células."><b>Hipertrofia:</b></span> Aumento no tamanho das células.</li>
                                <li><span class="tooltip" data-definition="Redução no tamanho e atividade metabólica de uma célula."><b>Atrofia:</b></span> Redução no tamanho e metabolismo celular.</li>
                                <li><span class="tooltip" data-definition="Mudança reversível de um tipo celular diferenciado por outro."><b>Metaplasia:</b></span> Substituição de um tipo celular por outro.</li>
                            </ul>
                            <h3>Estudo de Caso: Hiperplasia Eritroide na Hipóxia Crônica</h3>
                            <p>Em grandes altitudes ou em doenças como a DPOC, a baixa de oxigênio (<span class="tooltip" data-definition="Baixa concentração de oxigênio nos tecidos.">hipóxia</span>) crônica estimula os rins a produzirem mais <span class="tooltip" data-definition="Eritropoietina, hormônio que estimula a produção de glóbulos vermelhos.">EPO</span>. A EPO age na medula óssea, causando uma hiperplasia da linhagem eritroide. Isso aumenta a massa de hemácias (policitemia secundária) para melhorar o transporte de oxigênio, mas o sangue excessivamente viscoso aumenta o risco de trombose.</p>
                        `,
                         quiz: [
                            { q: "O aumento no TAMANHO das células em resposta a um estímulo é chamado de:", options: ["Hiperplasia", "Atrofia", "Hipertrofia", "Metaplasia"], a: 2, d: 'Fácil' },
                            { q: "Na hipóxia crônica, qual hormônio é produzido em maior quantidade pelos rins para estimular a medula óssea?", options: ["Trombopoietina", "Insulina", "Testosterona", "Eritropoietina (EPO)"], a: 3, d: 'Médio' },
                            { q: "A policitemia secundária é um exemplo de qual tipo de adaptação celular na medula óssea?", options: ["Atrofia", "Hiperplasia", "Metaplasia", "Nenhuma das anteriores"], a: 1, d: 'Médio' }
                        ]
                    },
                     {
                        id: 'sec1-3',
                        title: 'Morte Celular e Hemólise',
                        content: `
                            <p>Existem duas vias principais de morte celular: apoptose e necrose.</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Morte celular programada, 'suicídio celular' organizado, sem inflamação."><b>Apoptose:</b></span> Processo ativo, regulado, que não causa inflamação. A célula encolhe e é fagocitada.</li>
                                <li><span class="tooltip" data-definition="Morte celular acidental, descontrolada, que sempre causa inflamação."><b>Necrose:</b></span> Processo passivo, resultado de lesão aguda. A célula incha, sua membrana se rompe e o conteúdo extravasa, causando inflamação.</li>
                            </ul>
                            <h3>Estudo de Caso: Anemia Falciforme</h3>
                            <p>Uma mutação no gene da β-globina cria a Hemoglobina S (HbS). Sob baixa tensão de oxigênio, a HbS se polimeriza, distorcendo os eritrócitos para a forma de foice. Esses eritrócitos rígidos são destruídos prematuramente (<span class="tooltip" data-definition="Destruição de hemácias.">hemólise</span>) e podem bloquear pequenos vasos (vaso-oclusão), causando dor intensa e <span class="tooltip" data-definition="Falta de suprimento sanguíneo para um tecido, levando à falta de oxigênio.">isquemia</span> tecidual.</p>
                        `,
                         quiz: [
                            { q: "Qual tipo de morte celular é caracterizado por ser um processo programado e que NÃO causa inflamação?", options: ["Necrose", "Apoptose", "Piroptose", "Oncrose"], a: 1, d: 'Fácil' },
                            { q: "A Anemia Falciforme é causada por uma mutação que cria qual tipo de hemoglobina anormal?", options: ["Hemoglobina A2", "Hemoglobina Fetal", "Hemoglobina S (HbS)", "Hemoglobina H"], a: 2, d: 'Médio' },
                            { q: "O que desencadeia o afoiçamento dos eritrócitos na Anemia Falciforme?", options: ["Alta tensão de oxigênio", "Baixa tensão de oxigênio", "Aumento da glicose no sangue", "Presença de anticorpos"], a: 1, d: 'Médio' }
                        ]
                    }
                ]
            },
            {
                id: 'mod2',
                title: 'Módulo 2: A Resposta do Hospedeiro: Inflamação e Reparo',
                icon: '🔬',
                image: 'inflammatory-response.jpg',
                sections: [
                    {
                        id: 'sec2-1',
                        title: 'Inflamação e o Leucograma',
                        content: `
                            <p>A inflamação é uma resposta protetora a agentes agressores. A <b>inflamação aguda</b> é rápida, de curta duração, e marcada pela migração de <span class="tooltip" data-definition="Tipo de leucócito que é a primeira linha de defesa contra infecções bacterianas.">neutrófilos</span>. A <b>inflamação crônica</b> é prolongada e envolve <span class="tooltip" data-definition="Tipos de leucócitos envolvidos na imunidade específica e memória imunológica.">linfócitos</span> e macrófagos.</p>
                            <h3>Padrões no Leucograma:</h3>
                            <ul>
                                <li><b>Neutrofilia:</b> Aumento de neutrófilos, comum em infecções bacterianas agudas.</li>
                                <li><b>Desvio à Esquerda:</b> Presença de neutrófilos imaturos (bastonetes), indica alta demanda inflamatória.
                                    <ul>
                                        <li><i>Regenerativo:</i> Neutrofilia com mais maduros que imaturos (bom prognóstico).</li>
                                        <li><i>Degenerativo:</i> Mais imaturos que maduros (mau prognóstico, comum na <span class="tooltip" data-definition="Resposta inflamatória sistêmica desregulada a uma infecção, que pode levar à falência de órgãos.">sepse</span>).</li>
                                    </ul>
                                </li>
                                <li><b>Linfocitose:</b> Aumento de linfócitos, típico de infecções virais.</li>
                            </ul>
                        `,
                        quiz: [
                            { q: "Qual célula é predominante na inflamação aguda?", options: ["Linfócito", "Macrófago", "Neutrófilo", "Plasmócito"], a: 2, d: 'Fácil' },
                            { q: "O que significa 'desvio à esquerda' no leucograma?", options: ["Aumento de linfócitos", "Presença de neutrófilos imaturos", "Redução de plaquetas", "Aumento de eosinófilos"], a: 1, d: 'Médio' },
                            { q: "Um desvio à esquerda degenerativo (mais imaturos que maduros) indica:", options: ["Uma resposta medular robusta e bom prognóstico", "Uma infecção viral leve", "Que a demanda excede a capacidade da medula, um mau prognóstico", "Uma reação alérgica"], a: 2, d: 'Difícil' }
                        ]
                    },
                    {
                        id: 'sec2-2',
                        title: 'Reparo Tecidual e Fibrose Medular',
                        content: `
                            <p>O reparo tecidual pode ocorrer por <b>regeneração</b> (restauração completa) ou <b>cicatrização</b> (<span class="tooltip" data-definition="Deposição de tecido conjuntivo, formando uma cicatriz.">fibrose</span>). A fibrose é orquestrada por fatores como <span class="tooltip" data-definition="Fator de Crescimento Transformador-beta, o principal indutor da fibrose.">TGF-β</span>.</p>
                            <h3>Estudo de Caso: Mielofibrose Primária (MFP)</h3>
                            <p>Na MFP, uma neoplasia dos precursores hematopoiéticos, os megacariócitos anormais liberam grandes quantidades de TGF-β e PDGF. Esses fatores estimulam fibroblastos normais a depositar colágeno excessivamente na medula óssea, levando à fibrose. A destruição do ambiente medular força a produção de sangue para outros órgãos (hematopoiese extramedular), liberando células imaturas na circulação (<span class="tooltip" data-definition="Presença de precursores de leucócitos e eritrócitos no sangue periférico.">leucoeritroblastose</span>) e hemácias em forma de lágrima (<span class="tooltip" data-definition="Hemácia em forma de lágrima, sugestiva de fibrose medular.">dacriócitos</span>).</p>
                        `,
                        quiz: [
                            { q: "Qual fator de crescimento é considerado o principal indutor da fibrose?", options: ["EPO", "G-CSF", "TGF-β", "PDGF"], a: 2, d: 'Médio' },
                            { q: "Na Mielofibrose Primária, quais células são as responsáveis pela produção dos fatores que causam a fibrose?", options: ["Os próprios fibroblastos neoplásicos", "Megacariócitos neoplásicos", "Linfócitos T", "Células endoteliais"], a: 1, d: 'Difícil' },
                            { q: "A presença de dacriócitos (hemácias em lágrima) no sangue periférico é altamente sugestiva de:", options: ["Anemia falciforme", "Infecção viral", "Fibrose medular", "Deficiência de ferro"], a: 2, d: 'Médio' }
                        ]
                    }
                ]
            },
            {
                id: 'mod3',
                title: 'Módulo 3: Distúrbios Hemodinâmicos e da Coagulação',
                icon: '🩸',
                image: 'blood-clotting-cascade.jpg',
                sections: [
                    {
                        id: 'sec3-1',
                        title: 'Hemostasia e Trombose',
                        content: `
                            <p>A <span class="tooltip" data-definition="Processo fisiológico que impede o sangramento, formando um coágulo no local da lesão.">hemostasia</span> é o equilíbrio entre manter o sangue fluido e formar coágulos. Ela se divide em:</p>
                            <ul>
                                <li><b>Hemostasia Primária:</b> Formação do tampão plaquetário. Envolve adesão (via <span class="tooltip" data-definition="Fator de von Willebrand, uma proteína que serve de ponte entre o colágeno e as plaquetas.">FvW</span>), ativação e agregação de plaquetas.</li>
                                <li><b>Hemostasia Secundária:</b> Ativação da cascata da coagulação para formar uma malha de fibrina estável, consolidando o coágulo. A <span class="tooltip" data-definition="Enzima central da coagulação, que converte fibrinogênio em fibrina.">trombina</span> é a enzima central.</li>
                            </ul>
                            <p>A <span class="tooltip" data-definition="Formação patológica de um coágulo dentro de um vaso sanguíneo intacto.">trombose</span> é influenciada pela <span class="tooltip" data-definition="Modelo que descreve os 3 fatores que contribuem para a trombose: lesão endotelial, alteração do fluxo sanguíneo e hipercoagulabilidade.">Tríade de Virchow</span>: lesão endotelial, estase/turbulência do fluxo e hipercoagulabilidade.</p>
                            <h3>Estudos de Caso:</h3>
                            <p><b>PTI (Púrpura Trombocitopênica Imune):</b> Defeito na hemostasia primária. Autoanticorpos destroem plaquetas. Clínica: <span class="tooltip" data-definition="Pequenos pontos hemorrágicos na pele ou mucosas.">petéquias</span> e equimoses.</p>
                            <p><b>Hemofilia A:</b> Defeito na hemostasia secundária. Deficiência do Fator VIII. Clínica: sangramentos profundos em articulações (<span class="tooltip" data-definition="Sangramento dentro de uma articulação.">hemartroses</span>) e músculos.</p>
                            <p><b><span class="tooltip" data-definition="Coagulação Intravascular Disseminada: ativação sistêmica da coagulação, levando a trombose e hemorragia por consumo de fatores.">CIVD</span>:</b> Estado trombo-hemorrágico paradoxal, com formação de microtrombos e sangramento por consumo de plaquetas e fatores de coagulação.</p>
                        `,
                        quiz: [
                            { q: "Qual processo é responsável pela formação do tampão plaquetário inicial?", options: ["Hemostasia Secundária", "Fibrinólise", "Hemostasia Primária", "Inflamação"], a: 2, d: 'Fácil' },
                            { q: "Um tempo de TTPA prolongado com um tempo de TP normal é característico de um defeito na hemostasia secundária, como na:", options: ["PTI", "Hemofilia A", "Anemia Falciforme", "Doença de von Willebrand"], a: 1, d: 'Médio' },
                            { q: "Qual dos seguintes componentes NÃO faz parte da Tríade de Virchow?", options: ["Lesão endotelial", "Hipercoagulabilidade", "Estase do fluxo sanguíneo", "Hipotensão arterial"], a: 3, d: 'Médio' },
                            { q: "Por que a CIVD é considerada uma síndrome 'trombo-hemorrágica'?", options: ["Porque causa apenas trombose", "Porque a formação disseminada de coágulos consome os fatores de coagulação, levando a sangramentos", "Porque causa apenas hemorragia", "Porque afeta apenas as artérias"], a: 1, d: 'Difícil' }
                        ]
                    }
                ]
            },
            {
                id: 'mod4',
                title: 'Módulo 4: Neoplasia e Autoimunidade',
                icon: '🧬',
                image: 'cancer-cell-division.jpg',
                sections: [
                    {
                        id: 'sec4-1',
                        title: 'Neoplasia e as "Marcas do Câncer"',
                        content: `
                            <p>O câncer é uma doença genética resultante do acúmulo de mutações em classes de genes como:</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Genes normais que promovem o crescimento celular. Quando mutados, tornam-se oncogenes."><b>Proto-oncogenes:</b></span> Atuam como 'aceleradores'.</li>
                                <li><span class="tooltip" data-definition="Genes que inibem a proliferação celular, atuando como 'freios'. Sua perda de função promove o câncer."><b>Genes Supressores de Tumor:</b></span> Atuam como 'freios'. O mais famoso é o <span class="tooltip" data-definition="Gene supressor de tumor conhecido como 'guardião do genoma'.">TP53</span>.</li>
                                <li><b>Genes de Reparo de DNA:</b> Mantêm a estabilidade do genoma.</li>
                            </ul>
                            <p>As <span class="tooltip" data-definition="Conjunto de capacidades biológicas adquiridas pelas células durante o desenvolvimento do câncer (proliferação, evasão da morte, etc.).">"Marcas do Câncer"</span> descrevem as capacidades que as células tumorais adquirem.</p>
                            <h3>Exemplos em Hematologia:</h3>
                            <p><b>LMC (Leucemia Mieloide Crônica):</b> Ilustra a 'sinalização proliferativa sustentada' através da quinase <span class="tooltip" data-definition="Oncoproteína de fusão resultante da translocação t(9;22), definidora da LMC.">BCR-ABL1</span>.</p>
                            <p><b>Linfoma Folicular (LF):</b> Mostra a 'resistência à morte celular' pela superexpressão da proteína anti-apoptótica <span class="tooltip" data-definition="Proteína anti-apoptótica. Sua superexpressão no Linfoma Folicular impede a morte celular programada.">BCL2</span>.</p>
                        `,
                        quiz: [
                            { q: "Genes que normalmente funcionam como 'freios' da proliferação celular são chamados de:", options: ["Oncogenes", "Proto-oncogenes", "Genes Supressores de Tumor", "Genes de reparo"], a: 2, d: 'Fácil' },
                            { q: "A translocação t(9;22) resulta na oncoproteína BCR-ABL1, que é a marca registrada de qual doença?", options: ["Linfoma Folicular", "Mieloma Múltiplo", "Leucemia Mieloide Aguda", "Leucemia Mieloide Crônica"], a: 3, d: 'Médio' },
                            { q: "No Linfoma Folicular, a superexpressão da proteína BCL2 confere qual 'marca do câncer' às células neoplásicas?", options: ["Indução de angiogênese", "Resistência à morte celular", "Sinalização proliferativa sustentada", "Invasão e metástase"], a: 1, d: 'Médio' },
                            { q: "O gene TP53 é o exemplo mais clássico de qual tipo de gene?", options: ["Proto-oncogene", "Gene de reparo de DNA", "Oncogene", "Gene supressor de tumor"], a: 3, d: 'Difícil' }
                        ]
                    },
                    {
                        id: 'sec4-2',
                        title: 'Autoimunidade e Citotoxicidade',
                        content: `
                            <p>A <span class="tooltip" data-definition="Falha do sistema imune em reconhecer os próprios tecidos, levando a um ataque contra o 'próprio'.">autoimunidade</span> é a quebra da <span class="tooltip" data-definition="Capacidade do sistema imune de distinguir o 'próprio' do 'não-próprio', evitando ataques ao próprio corpo.">tolerância imunológica</span>. A <span class="tooltip" data-definition="Reação imune mediada por anticorpos (IgG/IgM) que se ligam a antígenos na superfície celular, causando destruição da célula.">Hipersensibilidade do Tipo II</span> é um mecanismo chave.</p>
                            <h3>Estudo de Caso: Anemia Hemolítica Autoimune (AHAI)</h3>
                            <p>A AHAI é a destruição prematura de eritrócitos por autoanticorpos. O diagnóstico é confirmado pelo <span class="tooltip" data-definition="Teste de Antiglobulina Direto (ou Teste de Coombs Direto), que detecta anticorpos e/ou complemento ligados à superfície das hemácias.">TAD (Teste de Coombs Direto)</span>.</p>
                            <ul>
                                <li><b>AHAI por Anticorpos Quentes (WAIHA):</b> Mediada por <b>IgG</b>. A hemólise é principalmente <b>extravascular (no baço)</b>. O TAD é positivo para IgG.</li>
                                <li><b>Doença da Aglutinina a Frio (CAD):</b> Mediada por <b>IgM</b>. A hemólise tem um componente <b>intravascular</b> por ativação do complemento. O TAD é positivo para <b>C3</b>.</li>
                            </ul>
                        `,
                        quiz: [
                            { q: "Qual teste laboratorial é crucial para confirmar o diagnóstico de Anemia Hemolítica Autoimune (AHAI)?", options: ["Hemograma completo", "Contagem de reticulócitos", "Teste de Coombs Direto (TAD)", "Biópsia de medula óssea"], a: 2, d: 'Fácil' },
                            { q: "Na AHAI por anticorpos quentes (WAIHA), qual classe de anticorpo está tipicamente envolvida e onde ocorre a principal destruição das hemácias?", options: ["IgM / Fígado", "IgA / Intestino", "IgG / Baço", "IgE / Pele"], a: 2, d: 'Médio' },
                            { q: "Um paciente com sintomas de acrocianose induzida pelo frio e um TAD positivo apenas para C3 provavelmente tem qual diagnóstico?", options: ["WAIHA", "Doença da Aglutinina a Frio (CAD)", "Linfoma Folicular", "Anemia Falciforme"], a: 1, d: 'Médio' },
                            { q: "Por que o TAD na Doença da Aglutinina a Frio é tipicamente positivo apenas para C3 e não para IgM?", options: ["Porque a IgM não é detectável por nenhum teste", "Porque a IgM se dissocia das hemácias na temperatura do laboratório (37°C), deixando apenas o complemento fixado para trás", "Porque a IgM destrói o reagente de Coombs", "Porque a IgM não ativa o complemento"], a: 1, d: 'Difícil' }
                        ]
                    }
                ]
            }
        ];

        // ===============================================
        // LÓGICA DA APLICAÇÃO (sem alterações, pois é genérica)
        // ===============================================

        const mainContent = document.getElementById('main-content');
        const sidebarNav = document.getElementById('sidebar-nav');
        const sidebar = document.getElementById('sidebar');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const quizModal = document.getElementById('quiz-modal');
        const quizModalContent = document.getElementById('quiz-modal-content');

        const renderPage = (targetId) => {
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`.nav-link[data-target="${targetId}"]`).classList.add('active');

            let html = '';
            if (targetId === 'home') {
                html = `
                    <div class="content-box">
                        <h2>Bem-vindo ao Curso Interativo de Patologia e Hematologia</h2>
                        <p>Esta plataforma foi desenhada para transformar seu estudo em uma experiência dinâmica e eficaz. Navegue pelos módulos no menu à esquerda para explorar o conteúdo, teste seus conhecimentos com quizzes e reforce o aprendizado com flashcards.</p>
                        <h3>Como usar:</h3>
                        <ul>
                            <li><b>📚 Conteúdo do Curso:</b> Acesse os capítulos da apostila em formato de acordeão interativo.</li>
                            <li><b>🧠 Flashcards de Revisão:</b> Revise os principais termos e conceitos de forma rápida.</li>
                            <li><b>✍️ Montar Simulado:</b> Crie provas personalizadas selecionando os temas, número de questões e dificuldade.</li>
                        </ul>
                        <p>Comece selecionando uma opção no menu lateral.</p>
                    </div>
                `;
            } else if (targetId === 'course-content') {
                html = renderCourseContent();
            } else if (targetId === 'flashcards') {
                html = renderFlashcards();
            } else if (targetId === 'custom-quiz') {
                html = renderCustomQuizBuilder();
            }
            mainContent.innerHTML = html;
            attachEventListenersForPage(targetId);
        };
        
        sidebarNav.addEventListener('click', (e) => {
            const navLink = e.target.closest('.nav-link');
            if (navLink) {
                e.preventDefault();
                const targetId = navLink.dataset.target;
                renderPage(targetId);
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                }
            }
        });
        
        hamburgerMenu.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        
        const renderCourseContent = () => {
            let contentHtml = `<div class="content-box"><h2>Conteúdo do Curso</h2><p>Clique em um módulo para expandir e ver os tópicos.</p></div>`;
            
            courseData.forEach(module => {
                contentHtml += `
                    <div class="accordion-item" data-module-id="${module.id}">
                        <div class="accordion-header">
                            <h4><span class="icon">${module.icon}</span> ${module.title}</h4>
                        </div>
                        <div class="accordion-content">
                            <img src="./${module.image}" alt="${module.title}" style="width:100%; height:200px; object-fit:cover; border-radius: 5px; margin-bottom: 20px;" onerror="this.style.display='none'">
                            <div class="tabs-container">
                                ${module.sections.map((section, index) => `
                                    <button class="tab-button ${index === 0 ? 'active' : ''}" data-tab-target="${section.id}">${section.title}</button>
                                `).join('')}
                            </div>
                            ${module.sections.map((section, index) => `
                                <div class="tab-content ${index === 0 ? 'active' : ''}" id="${section.id}">
                                    ${section.content}
                                    <br>
                                    <button class="button start-quiz-btn" data-quiz-module="${module.id}" data-quiz-section="${section.id}">Testar Conhecimentos</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            return contentHtml;
        };
        
        const renderFlashcards = () => {
            const allFlashcards = courseData.flatMap(mod => 
                mod.sections.flatMap(sec => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = sec.content;
                    return Array.from(tempDiv.querySelectorAll('.tooltip')).map(t => ({
                        term: t.textContent,
                        definition: t.dataset.definition
                    }));
                })
            ).filter((value, index, self) => self.findIndex(t => t.term === value.term) === index);

            if (allFlashcards.length === 0) {
                 return `<div class="content-box"><h2>Flashcards</h2><p>Nenhum flashcard disponível.</p></div>`;
            }

            let flashcardState = {
                cards: allFlashcards,
                currentIndex: 0
            };
            
            setTimeout(() => {
                const container = document.getElementById('flashcard-container');
                if (container) {
                    container.dataset.state = JSON.stringify(flashcardState);
                    updateFlashcardView();
                }
            }, 0);

            return `
                <div class="content-box">
                    <h2>Flashcards de Revisão</h2>
                    <p>Clique no card para virar. Use os botões para navegar.</p>
                    <div class="flashcard-container" id="flashcard-container">
                        <div class="flashcard" id="flashcard">
                            <div class="flashcard-inner">
                                <div class="flashcard-front" id="flashcard-front"></div>
                                <div class="flashcard-back" id="flashcard-back"></div>
                            </div>
                        </div>
                        <div class="flashcard-nav">
                            <button class="button secondary" id="prev-card">Anterior</button>
                            <span id="card-counter"></span>
                            <button class="button secondary" id="next-card">Próximo</button>
                        </div>
                         <button class="button" id="shuffle-cards" style="margin-top: 15px;">Embaralhar</button>
                    </div>
                </div>
            `;
        };

        const updateFlashcardView = () => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;

            let state = JSON.parse(container.dataset.state);
            const card = state.cards[state.currentIndex];

            document.getElementById('flashcard-front').textContent = card.term;
            document.getElementById('flashcard-back').textContent = card.definition;
            document.getElementById('card-counter').textContent = `${state.currentIndex + 1} / ${state.cards.length}`;
            document.getElementById('flashcard').classList.remove('flipped');
        };

        const navigateFlashcard = (direction) => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;
            
            let state = JSON.parse(container.dataset.state);
            state.currentIndex += direction;
            if (state.currentIndex < 0) state.currentIndex = state.cards.length - 1;
            if (state.currentIndex >= state.cards.length) state.currentIndex = 0;
            
            container.dataset.state = JSON.stringify(state);
            updateFlashcardView();
        };

        const shuffleFlashcards = () => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;

            let state = JSON.parse(container.dataset.state);
            for (let i = state.cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [state.cards[i], state.cards[j]] = [state.cards[j], state.cards[i]];
            }
            state.currentIndex = 0;
            container.dataset.state = JSON.stringify(state);
            updateFlashcardView();
        };

        const renderCustomQuizBuilder = () => {
            return `
                <div class="content-box">
                    <h2>Montar Simulado Personalizado</h2>
                    <p>Escolha os temas, o número de questões e a dificuldade para criar sua prova.</p>
                    <form id="custom-quiz-form">
                        <div class="quiz-builder-form-group">
                            <label>1. Selecione os Temas:</label>
                            <div class="checkbox-group">
                                ${courseData.map(mod => mod.sections.map(sec => `
                                    <label><input type="checkbox" name="topics" value="${sec.id}"> ${mod.title.split(':')[0]} - ${sec.title}</label>
                                `).join('')).join('<br>')}
                            </div>
                        </div>
                        <div class="quiz-builder-form-group">
                            <label for="num-questions">2. Número de Questões: <span id="num-questions-value">20</span></label>
                            <input type="range" id="num-questions" name="numQuestions" min="5" max="50" value="20">
                        </div>
                        <div class="quiz-builder-form-group">
                             <label>3. Nível de Dificuldade:</label>
                             <div class="checkbox-group">
                                <label><input type="checkbox" name="difficulty" value="Fácil" checked> Fácil</label>
                                <label><input type="checkbox" name="difficulty" value="Médio" checked> Médio</label>
                                <label><input type="checkbox" name="difficulty" value="Difícil" checked> Difícil</label>
                             </div>
                        </div>
                        <button type="submit" class="button">Gerar Simulado</button>
                    </form>
                </div>
            `;
        };
        
        const startQuiz = (quizData, title) => {
            let quizHtml = `
                <span class="close-button" id="close-quiz-modal">&times;</span>
                <h2>${title}</h2>
                <form id="quiz-form">
            `;
            let startTime = Date.now();
            quizData.forEach((q, index) => {
                quizHtml += `
                    <div class="quiz-question">
                        <p><b>${index + 1}. ${q.q}</b></p>
                        <div class="quiz-options">
                            ${q.options.map((opt, i) => `
                                <label>
                                    <input type="radio" name="question${index}" value="${i}">
                                    ${opt}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            quizHtml += `<button type="submit" class="button">Finalizar Quiz</button></form>`;
            
            quizModalContent.innerHTML = quizHtml;
            quizModal.style.display = 'flex';

            document.getElementById('close-quiz-modal').addEventListener('click', () => quizModal.style.display = 'none');
            
            document.getElementById('quiz-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const endTime = Date.now();
                const timeTaken = Math.round((endTime - startTime) / 1000); // em segundos
                const formData = new FormData(e.target);
                let score = 0;
                let results = [];

                quizData.forEach((q, index) => {
                    const userAnswer = formData.get(`question${index}`);
                    const isCorrect = userAnswer !== null && parseInt(userAnswer) === q.a;
                    if (isCorrect) score++;
                    results.push({ question: q, userAnswer, isCorrect });
                });
                
                showQuizResult(score, quizData.length, results, title, timeTaken);
            });
        };
        
        const showQuizResult = (score, total, results, title, timeTaken) => {
            const percentage = total > 0 ? ((score / total) * 100).toFixed(1) : 0;
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;

            let resultHtml = `
                <span class="close-button" id="close-result-modal">&times;</span>
                <h2>Resultado: ${title}</h2>
                <div class="quiz-result">
                    <h3>Sua pontuação: ${score} de ${total} (${percentage}%)</h3>
                    <p><b>Tempo gasto:</b> ${minutes} min e ${seconds} seg</p>
                    <p>${percentage >= 70 ? 'Parabéns, ótimo resultado!' : 'Continue estudando para melhorar!'}</p>
                    <hr>
                    <h4>Revisão das Questões:</h4>
                </div>
            `;

            results.forEach(res => {
                resultHtml += `
                    <div class="review-question ${res.isCorrect ? 'correct' : 'incorrect'}">
                        <p><b>${res.question.q}</b></p>
                        <p>Sua resposta: ${res.userAnswer !== null ? res.question.options[res.userAnswer] : 'Não respondida'}</p>
                        ${!res.isCorrect ? `<p>Resposta correta: <b>${res.question.options[res.question.a]}</b></p>` : ''}
                    </div>
                `;
            });
            
            quizModalContent.innerHTML = resultHtml;
            document.getElementById('close-result-modal').addEventListener('click', () => quizModal.style.display = 'none');
        };

        const attachEventListenersForPage = (pageId) => {
            if (pageId === 'course-content') {
                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const item = header.parentElement;
                        const content = item.querySelector('.accordion-content');
                        
                        if (item.classList.contains('active')) {
                            item.classList.remove('active');
                            content.style.maxHeight = '0';
                        } else {
                            document.querySelectorAll('.accordion-item.active').forEach(activeItem => {
                                activeItem.classList.remove('active');
                                activeItem.querySelector('.accordion-content').style.maxHeight = '0';
                            });
                            item.classList.add('active');
                            content.style.maxHeight = content.scrollHeight + 'px';
                        }
                    });
                });
                
                document.querySelectorAll('.tabs-container').forEach(container => {
                    container.addEventListener('click', (e) => {
                        if (e.target.matches('.tab-button')) {
                            const tabId = e.target.dataset.tabTarget;
                            const accordionContent = container.closest('.accordion-content');
                            
                            container.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                            e.target.classList.add('active');
                            
                            accordionContent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                            accordionContent.querySelector(`#${tabId}`).classList.add('active');
                        }
                    });
                });

                document.querySelectorAll('.start-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const moduleId = btn.dataset.quizModule;
                        const sectionId = btn.dataset.quizSection;
                        const module = courseData.find(m => m.id === moduleId);
                        const section = module.sections.find(s => s.id === sectionId);
                        startQuiz(section.quiz, `Quiz: ${section.title}`);
                    });
                });
            } else if (pageId === 'flashcards') {
                document.getElementById('flashcard').addEventListener('click', e => e.currentTarget.classList.toggle('flipped'));
                document.getElementById('prev-card').addEventListener('click', () => navigateFlashcard(-1));
                document.getElementById('next-card').addEventListener('click', () => navigateFlashcard(1));
                document.getElementById('shuffle-cards').addEventListener('click', shuffleFlashcards);
            } else if (pageId === 'custom-quiz') {
                document.getElementById('num-questions').addEventListener('input', (e) => {
                    document.getElementById('num-questions-value').textContent = e.target.value;
                });

                document.getElementById('custom-quiz-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const selectedTopics = formData.getAll('topics');
                    const numQuestions = parseInt(formData.get('numQuestions'));
                    const selectedDifficulties = formData.getAll('difficulty');
                    
                    if (selectedTopics.length === 0) {
                        alert('Por favor, selecione pelo menos um tema.');
                        return;
                    }

                    let questionPool = courseData.flatMap(mod => mod.sections)
                        .filter(sec => selectedTopics.includes(sec.id))
                        .flatMap(sec => sec.quiz)
                        .filter(q => selectedDifficulties.includes(q.d));
                    
                    questionPool.sort(() => 0.5 - Math.random());
                    const finalQuizQuestions = questionPool.slice(0, numQuestions);

                    if (finalQuizQuestions.length === 0) {
                        alert('Nenhuma questão encontrada para os critérios selecionados. Tente selecionar mais temas ou dificuldades.');
                        return;
                    }
                    
                    startQuiz(finalQuizQuestions, 'Simulado Personalizado');
                });
            }
        };

        renderPage('home');
    });
    </script>
</body>
</html>
