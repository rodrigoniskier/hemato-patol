<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patologia Geral e Hematologia Interativa</title>

    <style>
        /* ------------------- */
        /* RESET E VARIAVEIS   */
        /* ------------------- */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --highlight-color: #e74c3c;
            --text-color: #333;
            --bg-color: #ecf0f1;
            --sidebar-width: 300px;
            --header-height: 60px;
            --border-radius: 8px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        /* ------------------- */
        /* LAYOUT PRINCIPAL    */
        /* ------------------- */
        .app-container {
            display: flex;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar-content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .content-wrapper {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-content {
            flex-grow: 1;
            padding: 20px;
            background-image: url('./laboratory-background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .main-footer {
            text-align: center;
            padding: 15px;
            background-color: var(--secondary-color);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }
        
        .content-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        /* ------------------- */
        /* SIDEBAR E NAVEGA√á√ÉO */
        /* ------------------- */
        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .sidebar-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .sidebar-nav li a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background 0.2s ease;
            margin-bottom: 5px;
        }

        .sidebar-nav li a:hover, .sidebar-nav li a.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid var(--highlight-color);
            padding-left: 11px;
        }
        
        .sidebar-nav li a .icon {
            margin-right: 15px;
            font-size: 1.2em;
        }

        .hamburger-menu {
            display: none; /* Oculto por padr√£o em telas grandes */
        }
        
        /* ------------------- */
        /* COMPONENTES GERAIS  */
        /* ------------------- */
        h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        h3 {
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        p { margin-bottom: 1em; }
        ul, ol { padding-left: 20px; margin-bottom: 1em; }

        .button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-size: 1em;
        }
        
        .button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .button.secondary { background-color: var(--secondary-color); }
        .button.secondary:hover { background-color: #1f2b38; }

        .button.danger { background-color: var(--highlight-color); }
        .button.danger:hover { background-color: #c0392b; }

        /* ------------------- */
        /* COMPONENTES INTERATIVOS */
        /* ------------------- */

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
            color: var(--primary-color);
            font-weight: bold;
            border-bottom: 2px dotted var(--primary-color);
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: var(--secondary-color);
            color: #fff;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
            font-weight: normal;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Accordion */
        .accordion-item {
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        .accordion-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-header::after {
            content: '+';
            font-size: 1.5em;
            transition: transform 0.3s ease;
        }
        .accordion-item.active .accordion-header::after {
            transform: rotate(45deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease;
            background-color: #fff;
            padding: 0 20px;
        }
        .accordion-item.active .accordion-content {
            padding: 20px;
        }
        
        /* Tabs */
        .tabs-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            flex-wrap: wrap;
        }
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Flashcards */
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .flashcard {
            width: 500px;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-size: 1.5em;
            text-align: center;
        }
        .flashcard-front {
            background: linear-gradient(135deg, #f0f0f0, #ffffff);
            color: var(--secondary-color);
        }
        .flashcard-back {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            transform: rotateY(180deg);
            font-size: 1.2em;
        }
        .flashcard-nav {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Quiz Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            position: relative;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .quiz-question { margin-bottom: 20px; }
        .quiz-options label {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .quiz-options label:hover { background-color: #f0f0f0; }

        .quiz-result div { margin-bottom: 10px; }
        .review-question {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
        }
        .review-question.correct { background-color: #d4edda; }
        .review-question.incorrect { background-color: #f8d7da; }
        
        /* Custom Quiz Builder */
        .quiz-builder-form-group {
            margin-bottom: 20px;
        }
        .quiz-builder-form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .quiz-builder-form-group input[type="range"] {
            width: 100%;
        }
        .quiz-builder-form-group .checkbox-group label {
            display: inline-block;
            margin-right: 15px;
            font-weight: normal;
        }

        /* ------------------- */
        /* RESPONSIVIDADE      */
        /* ------------------- */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
                box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            }
            .content-wrapper {
                margin-left: 0;
            }
            .hamburger-menu {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1001;
                background-color: var(--secondary-color);
                color: white;
                border: none;
                border-radius: 50%;
                width: 50px;
                height: 50px;
                font-size: 24px;
                cursor: pointer;
                box-shadow: var(--shadow);
            }
            .flashcard {
                width: 100%;
                max-width: 400px;
            }
        }
        
        @media (max-width: 576px) {
            .content-box {
                padding: 15px;
            }
            .flashcard {
                height: 250px;
                font-size: 1.2em;
            }
            .flashcard-back {
                font-size: 1em;
            }
            .tabs-container {
                flex-direction: column;
            }
            .tab-button {
                width: 100%;
                text-align: left;
                border-bottom: 1px solid #ccc;
            }
            .tab-button.active {
                border-bottom: 3px solid var(--primary-color);
            }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <h1>Patologia Interativa</h1>
                    <p>Princ√≠pios e Aplica√ß√µes em Hematologia</p>
                </div>
                <nav class="sidebar-nav" id="sidebar-nav">
                    <ul>
                        <li><a href="#" class="nav-link active" data-target="home"><span class="icon">üè†</span> In√≠cio</a></li>
                        <li><a href="#" class="nav-link" data-target="course-content"><span class="icon">üìö</span> Conte√∫do do Curso</a></li>
                        <li><a href="#" class="nav-link" data-target="flashcards"><span class="icon">üß†</span> Flashcards de Revis√£o</a></li>
                        <li><a href="#" class="nav-link" data-target="custom-quiz"><span class="icon">‚úçÔ∏è</span> Montar Simulado</a></li>
                    </ul>
                </nav>
            </div>
        </aside>

        <button class="hamburger-menu" id="hamburger-menu">‚ò∞</button>

        <div class="content-wrapper">
            <main class="main-content" id="main-content">
                </main>

            <footer class="main-footer">
                <p>&copy; 2025 Parceiro de Programa√ß√£o. Todos os direitos reservados.</p>
                <p>Conte√∫do educacional adaptado do material fornecido.</p>
            </footer>
        </div>
    </div>

    <div id="quiz-modal" class="modal">
        <div class="modal-content" id="quiz-modal-content">
            </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ===============================================
        // BANCO DE DADOS - Conte√∫do, Quizzes, Flashcards
        // ===============================================
        const courseData = [
            {
                id: 'mod1',
                title: 'M√≥dulo 1: A C√©lula Sob Amea√ßa: Les√£o, Adapta√ß√£o e Morte',
                icon: 'ü©∫',
                image: 'hematopoietic-stem-cells.jpg',
                sections: [
                    {
                        id: 'sec1-1',
                        title: 'Les√£o Celular e Toxicidade Medular',
                        content: `
                            <p>A patologia estuda as rea√ß√µes de c√©lulas e tecidos a est√≠mulos nocivos. A c√©lula opera em <span class="tooltip" data-definition="Estado de equil√≠brio din√¢mico da c√©lula.">homeostase</span>, mas estresse severo ou prolongado causa les√£o. Se o ponto de n√£o retorno √© ultrapassado, a les√£o torna-se irrevers√≠vel, culminando na morte celular.</p>
                            <h3>Mecanismos de Les√£o Celular:</h3>
                            <ul>
                                <li><b>Deple√ß√£o de <span class="tooltip" data-definition="Adenosina Trifosfato, a principal moeda energ√©tica da c√©lula.">ATP</span>:</b> A falta de energia por <span class="tooltip" data-definition="Baixa concentra√ß√£o de oxig√™nio nos tecidos.">hip√≥xia</span> ou toxinas afeta bombas i√¥nicas (causando edema celular) e a s√≠ntese de prote√≠nas.</li>
                                <li><b>Dano Mitocondrial:</b> Pode levar √† falha na produ√ß√£o de ATP e √† libera√ß√£o de prote√≠nas que ativam a <span class="tooltip" data-definition="Morte celular programada, um processo organizado e sem inflama√ß√£o.">apoptose</span>, como o citocromo c.</li>
                                <li><b>Influxo de C√°lcio (Ca¬≤+):</b> Ativa enzimas destrutivas (fosfolipases, proteases) que degradam componentes celulares.</li>
                                <li><b>Estresse Oxidativo:</b> O ac√∫mulo de <span class="tooltip" data-definition="Esp√©cies Reativas de Oxig√™nio, ou radicais livres, que causam dano celular.">EROs</span> danifica lip√≠dios, prote√≠nas e DNA.</li>
                            </ul>
                            <h3>Estudo de Caso: Toxicidade do Benzeno</h3>
                            <p>O benzeno √© metabolizado no f√≠gado em compostos reativos que atacam as <span class="tooltip" data-definition="C√©lula-tronco hematopoi√©tica, respons√°vel por gerar todas as c√©lulas do sangue.">CTHs</span> na medula √≥ssea. Isso causa estresse oxidativo, dano ao DNA e pode levar √† <span class="tooltip" data-definition="Redu√ß√£o de todas as linhagens celulares do sangue (eritr√≥citos, leuc√≥citos, plaquetas).">pancitopenia</span> ou at√© Leucemia Mieloide Aguda (<span class="tooltip" data-definition="C√¢ncer que se origina nas c√©lulas mieloides da medula √≥ssea.">LMA</span>).</p>
                        `,
                        quiz: [
                            { q: "Qual o termo para o estado de equil√≠brio din√¢mico da c√©lula?", options: ["Metaplasia", "Homeostase", "Hip√≥xia", "Apoptose"], a: 1, d: 'F√°cil' },
                            { q: "Qual dos seguintes N√ÉO √© um mecanismo prim√°rio de les√£o celular?", options: ["Deple√ß√£o de ATP", "Dano mitocondrial", "Aumento da s√≠ntese de prote√≠nas", "Estresse oxidativo"], a: 2, d: 'M√©dio' },
                            { q: "A toxicidade do Benzeno afeta primariamente qual tipo de c√©lula na medula √≥ssea?", options: ["Linf√≥citos T", "Plasm√≥citos", "C√©lulas-tronco hematopoi√©ticas (CTHs)", "Eritr√≥citos maduros"], a: 2, d: 'M√©dio' },
                            { q: "O influxo excessivo de qual √≠on ativa enzimas destrutivas como fosfolipases e proteases durante a les√£o celular?", options: ["S√≥dio (Na+)", "Pot√°ssio (K+)", "C√°lcio (Ca¬≤+)", "Cloro (Cl-)"], a: 2, d: 'Dif√≠cil' }
                        ]
                    },
                    {
                        id: 'sec1-2',
                        title: 'Adapta√ß√£o Celular e Respostas Medulares',
                        content: `
                            <p>C√©lulas podem se adaptar a estresses para sobreviver. As adapta√ß√µes incluem:</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Aumento no N√öMERO de c√©lulas."><b>Hiperplasia:</b></span> Aumento no n√∫mero de c√©lulas.</li>
                                <li><span class="tooltip" data-definition="Aumento no TAMANHO das c√©lulas."><b>Hipertrofia:</b></span> Aumento no tamanho das c√©lulas.</li>
                                <li><span class="tooltip" data-definition="Redu√ß√£o no tamanho e atividade metab√≥lica de uma c√©lula."><b>Atrofia:</b></span> Redu√ß√£o no tamanho e metabolismo celular.</li>
                                <li><span class="tooltip" data-definition="Mudan√ßa revers√≠vel de um tipo celular diferenciado por outro."><b>Metaplasia:</b></span> Substitui√ß√£o de um tipo celular por outro.</li>
                            </ul>
                            <h3>Estudo de Caso: Hiperplasia Eritroide na Hip√≥xia Cr√¥nica</h3>
                            <p>Em grandes altitudes ou em doen√ßas como a DPOC, a baixa de oxig√™nio (<span class="tooltip" data-definition="Baixa concentra√ß√£o de oxig√™nio nos tecidos.">hip√≥xia</span>) cr√¥nica estimula os rins a produzirem mais <span class="tooltip" data-definition="Eritropoietina, horm√¥nio que estimula a produ√ß√£o de gl√≥bulos vermelhos.">EPO</span>. A EPO age na medula √≥ssea, causando uma hiperplasia da linhagem eritroide. Isso aumenta a massa de hem√°cias (policitemia secund√°ria) para melhorar o transporte de oxig√™nio, mas o sangue excessivamente viscoso aumenta o risco de trombose.</p>
                        `,
                         quiz: [
                            { q: "O aumento no TAMANHO das c√©lulas em resposta a um est√≠mulo √© chamado de:", options: ["Hiperplasia", "Atrofia", "Hipertrofia", "Metaplasia"], a: 2, d: 'F√°cil' },
                            { q: "Na hip√≥xia cr√¥nica, qual horm√¥nio √© produzido em maior quantidade pelos rins para estimular a medula √≥ssea?", options: ["Trombopoietina", "Insulina", "Testosterona", "Eritropoietina (EPO)"], a: 3, d: 'M√©dio' },
                            { q: "A policitemia secund√°ria √© um exemplo de qual tipo de adapta√ß√£o celular na medula √≥ssea?", options: ["Atrofia", "Hiperplasia", "Metaplasia", "Nenhuma das anteriores"], a: 1, d: 'M√©dio' }
                        ]
                    },
                     {
                        id: 'sec1-3',
                        title: 'Morte Celular e Hem√≥lise',
                        content: `
                            <p>Existem duas vias principais de morte celular: apoptose e necrose.</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Morte celular programada, 'suic√≠dio celular' organizado, sem inflama√ß√£o."><b>Apoptose:</b></span> Processo ativo, regulado, que n√£o causa inflama√ß√£o. A c√©lula encolhe e √© fagocitada.</li>
                                <li><span class="tooltip" data-definition="Morte celular acidental, descontrolada, que sempre causa inflama√ß√£o."><b>Necrose:</b></span> Processo passivo, resultado de les√£o aguda. A c√©lula incha, sua membrana se rompe e o conte√∫do extravasa, causando inflama√ß√£o.</li>
                            </ul>
                            <h3>Estudo de Caso: Anemia Falciforme</h3>
                            <p>Uma muta√ß√£o no gene da Œ≤-globina cria a Hemoglobina S (HbS). Sob baixa tens√£o de oxig√™nio, a HbS se polimeriza, distorcendo os eritr√≥citos para a forma de foice. Esses eritr√≥citos r√≠gidos s√£o destru√≠dos prematuramente (<span class="tooltip" data-definition="Destrui√ß√£o de hem√°cias.">hem√≥lise</span>) e podem bloquear pequenos vasos (vaso-oclus√£o), causando dor intensa e <span class="tooltip" data-definition="Falta de suprimento sangu√≠neo para um tecido, levando √† falta de oxig√™nio.">isquemia</span> tecidual.</p>
                        `,
                         quiz: [
                            { q: "Qual tipo de morte celular √© caracterizado por ser um processo programado e que N√ÉO causa inflama√ß√£o?", options: ["Necrose", "Apoptose", "Piroptose", "Oncrose"], a: 1, d: 'F√°cil' },
                            { q: "A Anemia Falciforme √© causada por uma muta√ß√£o que cria qual tipo de hemoglobina anormal?", options: ["Hemoglobina A2", "Hemoglobina Fetal", "Hemoglobina S (HbS)", "Hemoglobina H"], a: 2, d: 'M√©dio' },
                            { q: "O que desencadeia o afoi√ßamento dos eritr√≥citos na Anemia Falciforme?", options: ["Alta tens√£o de oxig√™nio", "Baixa tens√£o de oxig√™nio", "Aumento da glicose no sangue", "Presen√ßa de anticorpos"], a: 1, d: 'M√©dio' }
                        ]
                    }
                ]
            },
            {
                id: 'mod2',
                title: 'M√≥dulo 2: A Resposta do Hospedeiro: Inflama√ß√£o e Reparo',
                icon: 'üî¨',
                image: 'inflammatory-response.jpg',
                sections: [
                    {
                        id: 'sec2-1',
                        title: 'Inflama√ß√£o e o Leucograma',
                        content: `
                            <p>A inflama√ß√£o √© uma resposta protetora a agentes agressores. A <b>inflama√ß√£o aguda</b> √© r√°pida, de curta dura√ß√£o, e marcada pela migra√ß√£o de <span class="tooltip" data-definition="Tipo de leuc√≥cito que √© a primeira linha de defesa contra infec√ß√µes bacterianas.">neutr√≥filos</span>. A <b>inflama√ß√£o cr√¥nica</b> √© prolongada e envolve <span class="tooltip" data-definition="Tipos de leuc√≥citos envolvidos na imunidade espec√≠fica e mem√≥ria imunol√≥gica.">linf√≥citos</span> e macr√≥fagos.</p>
                            <h3>Padr√µes no Leucograma:</h3>
                            <ul>
                                <li><b>Neutrofilia:</b> Aumento de neutr√≥filos, comum em infec√ß√µes bacterianas agudas.</li>
                                <li><b>Desvio √† Esquerda:</b> Presen√ßa de neutr√≥filos imaturos (bastonetes), indica alta demanda inflamat√≥ria.
                                    <ul>
                                        <li><i>Regenerativo:</i> Neutrofilia com mais maduros que imaturos (bom progn√≥stico).</li>
                                        <li><i>Degenerativo:</i> Mais imaturos que maduros (mau progn√≥stico, comum na <span class="tooltip" data-definition="Resposta inflamat√≥ria sist√™mica desregulada a uma infec√ß√£o, que pode levar √† fal√™ncia de √≥rg√£os.">sepse</span>).</li>
                                    </ul>
                                </li>
                                <li><b>Linfocitose:</b> Aumento de linf√≥citos, t√≠pico de infec√ß√µes virais.</li>
                            </ul>
                        `,
                        quiz: [
                            { q: "Qual c√©lula √© predominante na inflama√ß√£o aguda?", options: ["Linf√≥cito", "Macr√≥fago", "Neutr√≥filo", "Plasm√≥cito"], a: 2, d: 'F√°cil' },
                            { q: "O que significa 'desvio √† esquerda' no leucograma?", options: ["Aumento de linf√≥citos", "Presen√ßa de neutr√≥filos imaturos", "Redu√ß√£o de plaquetas", "Aumento de eosin√≥filos"], a: 1, d: 'M√©dio' },
                            { q: "Um desvio √† esquerda degenerativo (mais imaturos que maduros) indica:", options: ["Uma resposta medular robusta e bom progn√≥stico", "Uma infec√ß√£o viral leve", "Que a demanda excede a capacidade da medula, um mau progn√≥stico", "Uma rea√ß√£o al√©rgica"], a: 2, d: 'Dif√≠cil' }
                        ]
                    },
                    {
                        id: 'sec2-2',
                        title: 'Reparo Tecidual e Fibrose Medular',
                        content: `
                            <p>O reparo tecidual pode ocorrer por <b>regenera√ß√£o</b> (restaura√ß√£o completa) ou <b>cicatriza√ß√£o</b> (<span class="tooltip" data-definition="Deposi√ß√£o de tecido conjuntivo, formando uma cicatriz.">fibrose</span>). A fibrose √© orquestrada por fatores como <span class="tooltip" data-definition="Fator de Crescimento Transformador-beta, o principal indutor da fibrose.">TGF-Œ≤</span>.</p>
                            <h3>Estudo de Caso: Mielofibrose Prim√°ria (MFP)</h3>
                            <p>Na MFP, uma neoplasia dos precursores hematopoi√©ticos, os megacari√≥citos anormais liberam grandes quantidades de TGF-Œ≤ e PDGF. Esses fatores estimulam fibroblastos normais a depositar col√°geno excessivamente na medula √≥ssea, levando √† fibrose. A destrui√ß√£o do ambiente medular for√ßa a produ√ß√£o de sangue para outros √≥rg√£os (hematopoiese extramedular), liberando c√©lulas imaturas na circula√ß√£o (<span class="tooltip" data-definition="Presen√ßa de precursores de leuc√≥citos e eritr√≥citos no sangue perif√©rico.">leucoeritroblastose</span>) e hem√°cias em forma de l√°grima (<span class="tooltip" data-definition="Hem√°cia em forma de l√°grima, sugestiva de fibrose medular.">dacri√≥citos</span>).</p>
                        `,
                        quiz: [
                            { q: "Qual fator de crescimento √© considerado o principal indutor da fibrose?", options: ["EPO", "G-CSF", "TGF-Œ≤", "PDGF"], a: 2, d: 'M√©dio' },
                            { q: "Na Mielofibrose Prim√°ria, quais c√©lulas s√£o as respons√°veis pela produ√ß√£o dos fatores que causam a fibrose?", options: ["Os pr√≥prios fibroblastos neopl√°sicos", "Megacari√≥citos neopl√°sicos", "Linf√≥citos T", "C√©lulas endoteliais"], a: 1, d: 'Dif√≠cil' },
                            { q: "A presen√ßa de dacri√≥citos (hem√°cias em l√°grima) no sangue perif√©rico √© altamente sugestiva de:", options: ["Anemia falciforme", "Infec√ß√£o viral", "Fibrose medular", "Defici√™ncia de ferro"], a: 2, d: 'M√©dio' }
                        ]
                    }
                ]
            },
            {
                id: 'mod3',
                title: 'M√≥dulo 3: Dist√∫rbios Hemodin√¢micos e da Coagula√ß√£o',
                icon: 'ü©∏',
                image: 'blood-clotting-cascade.jpg',
                sections: [
                    {
                        id: 'sec3-1',
                        title: 'Hemostasia e Trombose',
                        content: `
                            <p>A <span class="tooltip" data-definition="Processo fisiol√≥gico que impede o sangramento, formando um co√°gulo no local da les√£o.">hemostasia</span> √© o equil√≠brio entre manter o sangue fluido e formar co√°gulos. Ela se divide em:</p>
                            <ul>
                                <li><b>Hemostasia Prim√°ria:</b> Forma√ß√£o do tamp√£o plaquet√°rio. Envolve ades√£o (via <span class="tooltip" data-definition="Fator de von Willebrand, uma prote√≠na que serve de ponte entre o col√°geno e as plaquetas.">FvW</span>), ativa√ß√£o e agrega√ß√£o de plaquetas.</li>
                                <li><b>Hemostasia Secund√°ria:</b> Ativa√ß√£o da cascata da coagula√ß√£o para formar uma malha de fibrina est√°vel, consolidando o co√°gulo. A <span class="tooltip" data-definition="Enzima central da coagula√ß√£o, que converte fibrinog√™nio em fibrina.">trombina</span> √© a enzima central.</li>
                            </ul>
                            <p>A <span class="tooltip" data-definition="Forma√ß√£o patol√≥gica de um co√°gulo dentro de um vaso sangu√≠neo intacto.">trombose</span> √© influenciada pela <span class="tooltip" data-definition="Modelo que descreve os 3 fatores que contribuem para a trombose: les√£o endotelial, altera√ß√£o do fluxo sangu√≠neo e hipercoagulabilidade.">Tr√≠ade de Virchow</span>: les√£o endotelial, estase/turbul√™ncia do fluxo e hipercoagulabilidade.</p>
                            <h3>Estudos de Caso:</h3>
                            <p><b>PTI (P√∫rpura Trombocitop√™nica Imune):</b> Defeito na hemostasia prim√°ria. Autoanticorpos destroem plaquetas. Cl√≠nica: <span class="tooltip" data-definition="Pequenos pontos hemorr√°gicos na pele ou mucosas.">pet√©quias</span> e equimoses.</p>
                            <p><b>Hemofilia A:</b> Defeito na hemostasia secund√°ria. Defici√™ncia do Fator VIII. Cl√≠nica: sangramentos profundos em articula√ß√µes (<span class="tooltip" data-definition="Sangramento dentro de uma articula√ß√£o.">hemartroses</span>) e m√∫sculos.</p>
                            <p><b><span class="tooltip" data-definition="Coagula√ß√£o Intravascular Disseminada: ativa√ß√£o sist√™mica da coagula√ß√£o, levando a trombose e hemorragia por consumo de fatores.">CIVD</span>:</b> Estado trombo-hemorr√°gico paradoxal, com forma√ß√£o de microtrombos e sangramento por consumo de plaquetas e fatores de coagula√ß√£o.</p>
                        `,
                        quiz: [
                            { q: "Qual processo √© respons√°vel pela forma√ß√£o do tamp√£o plaquet√°rio inicial?", options: ["Hemostasia Secund√°ria", "Fibrin√≥lise", "Hemostasia Prim√°ria", "Inflama√ß√£o"], a: 2, d: 'F√°cil' },
                            { q: "Um tempo de TTPA prolongado com um tempo de TP normal √© caracter√≠stico de um defeito na hemostasia secund√°ria, como na:", options: ["PTI", "Hemofilia A", "Anemia Falciforme", "Doen√ßa de von Willebrand"], a: 1, d: 'M√©dio' },
                            { q: "Qual dos seguintes componentes N√ÉO faz parte da Tr√≠ade de Virchow?", options: ["Les√£o endotelial", "Hipercoagulabilidade", "Estase do fluxo sangu√≠neo", "Hipotens√£o arterial"], a: 3, d: 'M√©dio' },
                            { q: "Por que a CIVD √© considerada uma s√≠ndrome 'trombo-hemorr√°gica'?", options: ["Porque causa apenas trombose", "Porque a forma√ß√£o disseminada de co√°gulos consome os fatores de coagula√ß√£o, levando a sangramentos", "Porque causa apenas hemorragia", "Porque afeta apenas as art√©rias"], a: 1, d: 'Dif√≠cil' }
                        ]
                    }
                ]
            },
            {
                id: 'mod4',
                title: 'M√≥dulo 4: Neoplasia e Autoimunidade',
                icon: 'üß¨',
                image: 'cancer-cell-division.jpg',
                sections: [
                    {
                        id: 'sec4-1',
                        title: 'Neoplasia e as "Marcas do C√¢ncer"',
                        content: `
                            <p>O c√¢ncer √© uma doen√ßa gen√©tica resultante do ac√∫mulo de muta√ß√µes em classes de genes como:</p>
                            <ul>
                                <li><span class="tooltip" data-definition="Genes normais que promovem o crescimento celular. Quando mutados, tornam-se oncogenes."><b>Proto-oncogenes:</b></span> Atuam como 'aceleradores'.</li>
                                <li><span class="tooltip" data-definition="Genes que inibem a prolifera√ß√£o celular, atuando como 'freios'. Sua perda de fun√ß√£o promove o c√¢ncer."><b>Genes Supressores de Tumor:</b></span> Atuam como 'freios'. O mais famoso √© o <span class="tooltip" data-definition="Gene supressor de tumor conhecido como 'guardi√£o do genoma'.">TP53</span>.</li>
                                <li><b>Genes de Reparo de DNA:</b> Mant√™m a estabilidade do genoma.</li>
                            </ul>
                            <p>As <span class="tooltip" data-definition="Conjunto de capacidades biol√≥gicas adquiridas pelas c√©lulas durante o desenvolvimento do c√¢ncer (prolifera√ß√£o, evas√£o da morte, etc.).">"Marcas do C√¢ncer"</span> descrevem as capacidades que as c√©lulas tumorais adquirem.</p>
                            <h3>Exemplos em Hematologia:</h3>
                            <p><b>LMC (Leucemia Mieloide Cr√¥nica):</b> Ilustra a 'sinaliza√ß√£o proliferativa sustentada' atrav√©s da quinase <span class="tooltip" data-definition="Oncoprote√≠na de fus√£o resultante da transloca√ß√£o t(9;22), definidora da LMC.">BCR-ABL1</span>.</p>
                            <p><b>Linfoma Folicular (LF):</b> Mostra a 'resist√™ncia √† morte celular' pela superexpress√£o da prote√≠na anti-apopt√≥tica <span class="tooltip" data-definition="Prote√≠na anti-apopt√≥tica. Sua superexpress√£o no Linfoma Folicular impede a morte celular programada.">BCL2</span>.</p>
                        `,
                        quiz: [
                            { q: "Genes que normalmente funcionam como 'freios' da prolifera√ß√£o celular s√£o chamados de:", options: ["Oncogenes", "Proto-oncogenes", "Genes Supressores de Tumor", "Genes de reparo"], a: 2, d: 'F√°cil' },
                            { q: "A transloca√ß√£o t(9;22) resulta na oncoprote√≠na BCR-ABL1, que √© a marca registrada de qual doen√ßa?", options: ["Linfoma Folicular", "Mieloma M√∫ltiplo", "Leucemia Mieloide Aguda", "Leucemia Mieloide Cr√¥nica"], a: 3, d: 'M√©dio' },
                            { q: "No Linfoma Folicular, a superexpress√£o da prote√≠na BCL2 confere qual 'marca do c√¢ncer' √†s c√©lulas neopl√°sicas?", options: ["Indu√ß√£o de angiog√™nese", "Resist√™ncia √† morte celular", "Sinaliza√ß√£o proliferativa sustentada", "Invas√£o e met√°stase"], a: 1, d: 'M√©dio' },
                            { q: "O gene TP53 √© o exemplo mais cl√°ssico de qual tipo de gene?", options: ["Proto-oncogene", "Gene de reparo de DNA", "Oncogene", "Gene supressor de tumor"], a: 3, d: 'Dif√≠cil' }
                        ]
                    },
                    {
                        id: 'sec4-2',
                        title: 'Autoimunidade e Citotoxicidade',
                        content: `
                            <p>A <span class="tooltip" data-definition="Falha do sistema imune em reconhecer os pr√≥prios tecidos, levando a um ataque contra o 'pr√≥prio'.">autoimunidade</span> √© a quebra da <span class="tooltip" data-definition="Capacidade do sistema imune de distinguir o 'pr√≥prio' do 'n√£o-pr√≥prio', evitando ataques ao pr√≥prio corpo.">toler√¢ncia imunol√≥gica</span>. A <span class="tooltip" data-definition="Rea√ß√£o imune mediada por anticorpos (IgG/IgM) que se ligam a ant√≠genos na superf√≠cie celular, causando destrui√ß√£o da c√©lula.">Hipersensibilidade do Tipo II</span> √© um mecanismo chave.</p>
                            <h3>Estudo de Caso: Anemia Hemol√≠tica Autoimune (AHAI)</h3>
                            <p>A AHAI √© a destrui√ß√£o prematura de eritr√≥citos por autoanticorpos. O diagn√≥stico √© confirmado pelo <span class="tooltip" data-definition="Teste de Antiglobulina Direto (ou Teste de Coombs Direto), que detecta anticorpos e/ou complemento ligados √† superf√≠cie das hem√°cias.">TAD (Teste de Coombs Direto)</span>.</p>
                            <ul>
                                <li><b>AHAI por Anticorpos Quentes (WAIHA):</b> Mediada por <b>IgG</b>. A hem√≥lise √© principalmente <b>extravascular (no ba√ßo)</b>. O TAD √© positivo para IgG.</li>
                                <li><b>Doen√ßa da Aglutinina a Frio (CAD):</b> Mediada por <b>IgM</b>. A hem√≥lise tem um componente <b>intravascular</b> por ativa√ß√£o do complemento. O TAD √© positivo para <b>C3</b>.</li>
                            </ul>
                        `,
                        quiz: [
                            { q: "Qual teste laboratorial √© crucial para confirmar o diagn√≥stico de Anemia Hemol√≠tica Autoimune (AHAI)?", options: ["Hemograma completo", "Contagem de reticul√≥citos", "Teste de Coombs Direto (TAD)", "Bi√≥psia de medula √≥ssea"], a: 2, d: 'F√°cil' },
                            { q: "Na AHAI por anticorpos quentes (WAIHA), qual classe de anticorpo est√° tipicamente envolvida e onde ocorre a principal destrui√ß√£o das hem√°cias?", options: ["IgM / F√≠gado", "IgA / Intestino", "IgG / Ba√ßo", "IgE / Pele"], a: 2, d: 'M√©dio' },
                            { q: "Um paciente com sintomas de acrocianose induzida pelo frio e um TAD positivo apenas para C3 provavelmente tem qual diagn√≥stico?", options: ["WAIHA", "Doen√ßa da Aglutinina a Frio (CAD)", "Linfoma Folicular", "Anemia Falciforme"], a: 1, d: 'M√©dio' },
                            { q: "Por que o TAD na Doen√ßa da Aglutinina a Frio √© tipicamente positivo apenas para C3 e n√£o para IgM?", options: ["Porque a IgM n√£o √© detect√°vel por nenhum teste", "Porque a IgM se dissocia das hem√°cias na temperatura do laborat√≥rio (37¬∞C), deixando apenas o complemento fixado para tr√°s", "Porque a IgM destr√≥i o reagente de Coombs", "Porque a IgM n√£o ativa o complemento"], a: 1, d: 'Dif√≠cil' }
                        ]
                    }
                ]
            }
        ];

        // ===============================================
        // L√ìGICA DA APLICA√á√ÉO (sem altera√ß√µes, pois √© gen√©rica)
        // ===============================================

        const mainContent = document.getElementById('main-content');
        const sidebarNav = document.getElementById('sidebar-nav');
        const sidebar = document.getElementById('sidebar');
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const quizModal = document.getElementById('quiz-modal');
        const quizModalContent = document.getElementById('quiz-modal-content');

        const renderPage = (targetId) => {
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`.nav-link[data-target="${targetId}"]`).classList.add('active');

            let html = '';
            if (targetId === 'home') {
                html = `
                    <div class="content-box">
                        <h2>Bem-vindo ao Curso Interativo de Patologia e Hematologia</h2>
                        <p>Esta plataforma foi desenhada para transformar seu estudo em uma experi√™ncia din√¢mica e eficaz. Navegue pelos m√≥dulos no menu √† esquerda para explorar o conte√∫do, teste seus conhecimentos com quizzes e reforce o aprendizado com flashcards.</p>
                        <h3>Como usar:</h3>
                        <ul>
                            <li><b>üìö Conte√∫do do Curso:</b> Acesse os cap√≠tulos da apostila em formato de acorde√£o interativo.</li>
                            <li><b>üß† Flashcards de Revis√£o:</b> Revise os principais termos e conceitos de forma r√°pida.</li>
                            <li><b>‚úçÔ∏è Montar Simulado:</b> Crie provas personalizadas selecionando os temas, n√∫mero de quest√µes e dificuldade.</li>
                        </ul>
                        <p>Comece selecionando uma op√ß√£o no menu lateral.</p>
                    </div>
                `;
            } else if (targetId === 'course-content') {
                html = renderCourseContent();
            } else if (targetId === 'flashcards') {
                html = renderFlashcards();
            } else if (targetId === 'custom-quiz') {
                html = renderCustomQuizBuilder();
            }
            mainContent.innerHTML = html;
            attachEventListenersForPage(targetId);
        };
        
        sidebarNav.addEventListener('click', (e) => {
            const navLink = e.target.closest('.nav-link');
            if (navLink) {
                e.preventDefault();
                const targetId = navLink.dataset.target;
                renderPage(targetId);
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                }
            }
        });
        
        hamburgerMenu.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });
        
        const renderCourseContent = () => {
            let contentHtml = `<div class="content-box"><h2>Conte√∫do do Curso</h2><p>Clique em um m√≥dulo para expandir e ver os t√≥picos.</p></div>`;
            
            courseData.forEach(module => {
                contentHtml += `
                    <div class="accordion-item" data-module-id="${module.id}">
                        <div class="accordion-header">
                            <h4><span class="icon">${module.icon}</span> ${module.title}</h4>
                        </div>
                        <div class="accordion-content">
                            <img src="./${module.image}" alt="${module.title}" style="width:100%; height:200px; object-fit:cover; border-radius: 5px; margin-bottom: 20px;" onerror="this.style.display='none'">
                            <div class="tabs-container">
                                ${module.sections.map((section, index) => `
                                    <button class="tab-button ${index === 0 ? 'active' : ''}" data-tab-target="${section.id}">${section.title}</button>
                                `).join('')}
                            </div>
                            ${module.sections.map((section, index) => `
                                <div class="tab-content ${index === 0 ? 'active' : ''}" id="${section.id}">
                                    ${section.content}
                                    <br>
                                    <button class="button start-quiz-btn" data-quiz-module="${module.id}" data-quiz-section="${section.id}">Testar Conhecimentos</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            return contentHtml;
        };
        
        const renderFlashcards = () => {
            const allFlashcards = courseData.flatMap(mod => 
                mod.sections.flatMap(sec => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = sec.content;
                    return Array.from(tempDiv.querySelectorAll('.tooltip')).map(t => ({
                        term: t.textContent,
                        definition: t.dataset.definition
                    }));
                })
            ).filter((value, index, self) => self.findIndex(t => t.term === value.term) === index);

            if (allFlashcards.length === 0) {
                 return `<div class="content-box"><h2>Flashcards</h2><p>Nenhum flashcard dispon√≠vel.</p></div>`;
            }

            let flashcardState = {
                cards: allFlashcards,
                currentIndex: 0
            };
            
            setTimeout(() => {
                const container = document.getElementById('flashcard-container');
                if (container) {
                    container.dataset.state = JSON.stringify(flashcardState);
                    updateFlashcardView();
                }
            }, 0);

            return `
                <div class="content-box">
                    <h2>Flashcards de Revis√£o</h2>
                    <p>Clique no card para virar. Use os bot√µes para navegar.</p>
                    <div class="flashcard-container" id="flashcard-container">
                        <div class="flashcard" id="flashcard">
                            <div class="flashcard-inner">
                                <div class="flashcard-front" id="flashcard-front"></div>
                                <div class="flashcard-back" id="flashcard-back"></div>
                            </div>
                        </div>
                        <div class="flashcard-nav">
                            <button class="button secondary" id="prev-card">Anterior</button>
                            <span id="card-counter"></span>
                            <button class="button secondary" id="next-card">Pr√≥ximo</button>
                        </div>
                         <button class="button" id="shuffle-cards" style="margin-top: 15px;">Embaralhar</button>
                    </div>
                </div>
            `;
        };

        const updateFlashcardView = () => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;

            let state = JSON.parse(container.dataset.state);
            const card = state.cards[state.currentIndex];

            document.getElementById('flashcard-front').textContent = card.term;
            document.getElementById('flashcard-back').textContent = card.definition;
            document.getElementById('card-counter').textContent = `${state.currentIndex + 1} / ${state.cards.length}`;
            document.getElementById('flashcard').classList.remove('flipped');
        };

        const navigateFlashcard = (direction) => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;
            
            let state = JSON.parse(container.dataset.state);
            state.currentIndex += direction;
            if (state.currentIndex < 0) state.currentIndex = state.cards.length - 1;
            if (state.currentIndex >= state.cards.length) state.currentIndex = 0;
            
            container.dataset.state = JSON.stringify(state);
            updateFlashcardView();
        };

        const shuffleFlashcards = () => {
            const container = document.getElementById('flashcard-container');
            if (!container || !container.dataset.state) return;

            let state = JSON.parse(container.dataset.state);
            for (let i = state.cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [state.cards[i], state.cards[j]] = [state.cards[j], state.cards[i]];
            }
            state.currentIndex = 0;
            container.dataset.state = JSON.stringify(state);
            updateFlashcardView();
        };

        const renderCustomQuizBuilder = () => {
            return `
                <div class="content-box">
                    <h2>Montar Simulado Personalizado</h2>
                    <p>Escolha os temas, o n√∫mero de quest√µes e a dificuldade para criar sua prova.</p>
                    <form id="custom-quiz-form">
                        <div class="quiz-builder-form-group">
                            <label>1. Selecione os Temas:</label>
                            <div class="checkbox-group">
                                ${courseData.map(mod => mod.sections.map(sec => `
                                    <label><input type="checkbox" name="topics" value="${sec.id}"> ${mod.title.split(':')[0]} - ${sec.title}</label>
                                `).join('')).join('<br>')}
                            </div>
                        </div>
                        <div class="quiz-builder-form-group">
                            <label for="num-questions">2. N√∫mero de Quest√µes: <span id="num-questions-value">20</span></label>
                            <input type="range" id="num-questions" name="numQuestions" min="5" max="50" value="20">
                        </div>
                        <div class="quiz-builder-form-group">
                             <label>3. N√≠vel de Dificuldade:</label>
                             <div class="checkbox-group">
                                <label><input type="checkbox" name="difficulty" value="F√°cil" checked> F√°cil</label>
                                <label><input type="checkbox" name="difficulty" value="M√©dio" checked> M√©dio</label>
                                <label><input type="checkbox" name="difficulty" value="Dif√≠cil" checked> Dif√≠cil</label>
                             </div>
                        </div>
                        <button type="submit" class="button">Gerar Simulado</button>
                    </form>
                </div>
            `;
        };
        
        const startQuiz = (quizData, title) => {
            let quizHtml = `
                <span class="close-button" id="close-quiz-modal">&times;</span>
                <h2>${title}</h2>
                <form id="quiz-form">
            `;
            let startTime = Date.now();
            quizData.forEach((q, index) => {
                quizHtml += `
                    <div class="quiz-question">
                        <p><b>${index + 1}. ${q.q}</b></p>
                        <div class="quiz-options">
                            ${q.options.map((opt, i) => `
                                <label>
                                    <input type="radio" name="question${index}" value="${i}">
                                    ${opt}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            quizHtml += `<button type="submit" class="button">Finalizar Quiz</button></form>`;
            
            quizModalContent.innerHTML = quizHtml;
            quizModal.style.display = 'flex';

            document.getElementById('close-quiz-modal').addEventListener('click', () => quizModal.style.display = 'none');
            
            document.getElementById('quiz-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const endTime = Date.now();
                const timeTaken = Math.round((endTime - startTime) / 1000); // em segundos
                const formData = new FormData(e.target);
                let score = 0;
                let results = [];

                quizData.forEach((q, index) => {
                    const userAnswer = formData.get(`question${index}`);
                    const isCorrect = userAnswer !== null && parseInt(userAnswer) === q.a;
                    if (isCorrect) score++;
                    results.push({ question: q, userAnswer, isCorrect });
                });
                
                showQuizResult(score, quizData.length, results, title, timeTaken);
            });
        };
        
        const showQuizResult = (score, total, results, title, timeTaken) => {
            const percentage = total > 0 ? ((score / total) * 100).toFixed(1) : 0;
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;

            let resultHtml = `
                <span class="close-button" id="close-result-modal">&times;</span>
                <h2>Resultado: ${title}</h2>
                <div class="quiz-result">
                    <h3>Sua pontua√ß√£o: ${score} de ${total} (${percentage}%)</h3>
                    <p><b>Tempo gasto:</b> ${minutes} min e ${seconds} seg</p>
                    <p>${percentage >= 70 ? 'Parab√©ns, √≥timo resultado!' : 'Continue estudando para melhorar!'}</p>
                    <hr>
                    <h4>Revis√£o das Quest√µes:</h4>
                </div>
            `;

            results.forEach(res => {
                resultHtml += `
                    <div class="review-question ${res.isCorrect ? 'correct' : 'incorrect'}">
                        <p><b>${res.question.q}</b></p>
                        <p>Sua resposta: ${res.userAnswer !== null ? res.question.options[res.userAnswer] : 'N√£o respondida'}</p>
                        ${!res.isCorrect ? `<p>Resposta correta: <b>${res.question.options[res.question.a]}</b></p>` : ''}
                    </div>
                `;
            });
            
            quizModalContent.innerHTML = resultHtml;
            document.getElementById('close-result-modal').addEventListener('click', () => quizModal.style.display = 'none');
        };

        const attachEventListenersForPage = (pageId) => {
            if (pageId === 'course-content') {
                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const item = header.parentElement;
                        const content = item.querySelector('.accordion-content');
                        
                        if (item.classList.contains('active')) {
                            item.classList.remove('active');
                            content.style.maxHeight = '0';
                        } else {
                            document.querySelectorAll('.accordion-item.active').forEach(activeItem => {
                                activeItem.classList.remove('active');
                                activeItem.querySelector('.accordion-content').style.maxHeight = '0';
                            });
                            item.classList.add('active');
                            content.style.maxHeight = content.scrollHeight + 'px';
                        }
                    });
                });
                
                document.querySelectorAll('.tabs-container').forEach(container => {
                    container.addEventListener('click', (e) => {
                        if (e.target.matches('.tab-button')) {
                            const tabId = e.target.dataset.tabTarget;
                            const accordionContent = container.closest('.accordion-content');
                            
                            container.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                            e.target.classList.add('active');
                            
                            accordionContent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                            accordionContent.querySelector(`#${tabId}`).classList.add('active');
                        }
                    });
                });

                document.querySelectorAll('.start-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const moduleId = btn.dataset.quizModule;
                        const sectionId = btn.dataset.quizSection;
                        const module = courseData.find(m => m.id === moduleId);
                        const section = module.sections.find(s => s.id === sectionId);
                        startQuiz(section.quiz, `Quiz: ${section.title}`);
                    });
                });
            } else if (pageId === 'flashcards') {
                document.getElementById('flashcard').addEventListener('click', e => e.currentTarget.classList.toggle('flipped'));
                document.getElementById('prev-card').addEventListener('click', () => navigateFlashcard(-1));
                document.getElementById('next-card').addEventListener('click', () => navigateFlashcard(1));
                document.getElementById('shuffle-cards').addEventListener('click', shuffleFlashcards);
            } else if (pageId === 'custom-quiz') {
                document.getElementById('num-questions').addEventListener('input', (e) => {
                    document.getElementById('num-questions-value').textContent = e.target.value;
                });

                document.getElementById('custom-quiz-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const selectedTopics = formData.getAll('topics');
                    const numQuestions = parseInt(formData.get('numQuestions'));
                    const selectedDifficulties = formData.getAll('difficulty');
                    
                    if (selectedTopics.length === 0) {
                        alert('Por favor, selecione pelo menos um tema.');
                        return;
                    }

                    let questionPool = courseData.flatMap(mod => mod.sections)
                        .filter(sec => selectedTopics.includes(sec.id))
                        .flatMap(sec => sec.quiz)
                        .filter(q => selectedDifficulties.includes(q.d));
                    
                    questionPool.sort(() => 0.5 - Math.random());
                    const finalQuizQuestions = questionPool.slice(0, numQuestions);

                    if (finalQuizQuestions.length === 0) {
                        alert('Nenhuma quest√£o encontrada para os crit√©rios selecionados. Tente selecionar mais temas ou dificuldades.');
                        return;
                    }
                    
                    startQuiz(finalQuizQuestions, 'Simulado Personalizado');
                });
            }
        };

        renderPage('home');
    });
    </script>
</body>
</html>
